{{- if .Values.secrets.dkim.create }}
apiVersion: v1
kind: Secret
metadata:
  name: dkim-keys
  labels:
    {{- include "kumomta.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.secrets.dkim.keys }}
  {{- range $key, $value := .Values.secrets.dkim.keys }}
  {{ $key }}: {{ $value | b64enc }}
  {{- end }}
  {{- else }}
  # Default key - a valid 2048-bit RSA key (already base64 encoded)
  # The key in values.yaml is already base64 encoded for Kubernetes Secret data field
  # To generate a new key: openssl genrsa 2048 | base64
  example.com.default.key: {{ .Values.secrets.dkim.defaultKey | default "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ3VndUo4aUdGU3huelAKV2lGT1U1VjYvZ3M1Ym1seDRoQ2Rib3NhdFpDeVc1U2tOei9Jd3ZBZVl4RWZzcmpzSHdrQ2hjMXM3ME4wUCt6UgpIdkJ2SXBWRjJrc0hUTTkzaE8wb0dpbWtpTUpNaGJicE5MMEpKdVAwL2ErbzJkU3Rsa1N2d2FKeGVzUlljTTAvCjBOMGhRb0NjU01DNCt1WGtBSEtHNlh5Y09jdlBhME5UT29NSHFrbWhDYWxmbVB3enU4TkRiWVZwZzltV3F3azcKK3pzbXE3aXRkNmJhbk1Tdlg1Vnh5TUxFRFNyVzBITkRpYTVuRWsvWERyWUVLSHQ5Sy9Cd0xXZDJvZjRZVmpIRgo5SnZieWpvcG51TWhVNWtkd1RMMHFkYjBJcXREUGwyL291d21yVnZRVkd4OWxxM3QyMU0yU0UvVGpDWVh0djFiCkZkZEpuejNQQWdNQkFBRUNnZ0VBRUVGazNpWWVCVnN6MlE5bzRYdVdXdm5sdGNNbWZmM2UxUUN0RGNuZE5wLzMKNSt3SzV2cUc2aGhlOUtMdDZDQzVTQ0RmNThaMGRCUllUTi9ObEZkQkFiRmtkOE9jalF6aGJSdUlIQ2x1WCtPOAp0ckJtUTJuNSswelRoZ09mSDA3MkN2WndnK2c1b3p0WldHNXVOV0RxZGZtdVAySXZub2k1ZDZrRzBIbEVhNGVjCjUrMFMvVmQwS2ZJOWdWRjBxbjhlRW9RVTFhUm9WdEp1eWlYME0wZElBSng0NjdOYkFMeDlZMzIvTGtQVGh2SGUKazdzQk1pNUowV3ljeERMdkxpZ3NlZ3BrNXRZd3U5bStZOG1FcXVxa0NHVGhJc0s0Yk5PUFRiMm80cmF6QXlWegpYOW5hN3VnMWUwS0xhS1hQT2Y5RldLbjlSdEhvRmNaSlIvZCs2MHR5MFFLQmdRRFo3YmF3T1lkQXNQZGxuZFQzCmYxYSsvcmh6bmpFV1pMY1RtU3crZ1MvNHhNU0NZb2sxSXNqZ3lMWU1DUU9rWHcrVGkyaGs0ZHdOVURscW9vRmIKYjgzd2YxUzhaQ2owK1JxWEJ1ZDdjM2dCWlozVFRzaUtsVnMwZzdaUVAwbVk1eExmaWJhaElRTEhFOVg3ZDhUWApTLzlNaGhBOFYzcjlsSnpFUnk1TnllZWNuUUtCZ1FETS8zSVdvNHBGb1F4eDJTQU5mQzdCdC82WVZXNzR2SllLCmhmUTE3eDJDZHV5QVd3dTBEbzJQQU9UQXJzY2kva2RXaGplQWZWSmlhTkZKNU1oVi9hNjlnYTZHbnZBSm41NUEKK0FmdmZpODFRVytSRGJ2UnpVR3NNWjNsZHRSTmQ1TjRaWjhnb3J4QzVyVWY5RDFkaUI1UHFJQzgrdjg2WEtWMQprTWhiSzFzNld3S0JnQ1QxQlNnNWVWQmxNbTlQSnRDYURiSHlMSUdlOENBbUVFNElpZEpId2tUanlaZDY4bDNLCmVscDBienIzUkdEWnBpQ1ZZYXpLQ0xGUlM0dGo1NkFFQTk2bkdVMmhocmlVamdmU3FlcnJtQXhVbVVFK2VRL1gKYUZJdGkvdHI0Q1ZIK3BGaUgxQ1A4cEtrTUlPbXVnRHc2R2lueTVVUUdORnNKSEc4eUlOMG5BeVpBb0dCQU1vMwprY3RUTjZySDJ3YlRNQk1kVk9Jekppb08zSkR4TnZEYWdyUlJVOExHblRWZ21vTGJlRGlBb1NhUlFrNzZsbFI3CndYUTJLM1ozL3p2dE90SFlsTzdMWmVYV0V1THJXYWl0QXViMGlvejJKNS9tOUVkWk9sY3ArcC9JUUZUS2grWlUKR0V5Uk96U2pjRGc5TGV0OXdxakJoM3pqKzdFT2d3a2Q4UVkrRnBmUkFvR0JBSzlxVGVWYkdOUEJ3RDJaYy9PdApBL1QzZ1pITlJOcjB3VEpkNmd2UlprdGh0VlhRLzJxcUdWNDR3MXhTRWx5SW1RdTBqV0F3NVJQMW84bHM4cmJNCnFrbDZKMzVQMWhaRWp6MldGZUdjZ1RoMytHSlkzWC9HS250akdBaWJUL2w4ZVV4TW5VbC9SdU1DQmJ6YUdMbXEKWmtsZHNxSDlXY3ZYYm1tQlY3WWNtQWFFCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K" }}
  {{- end }}
{{- end }}

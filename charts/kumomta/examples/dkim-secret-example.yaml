###################################
# Example Kubernetes Secret for DKIM Keys
###################################
# 
# This file shows how to create a Kubernetes Secret containing
# DKIM private keys for example.com
#
# IMPORTANT: This is an EXAMPLE file. Do NOT commit actual private keys
# to version control. Generate keys separately and create the Secret
# using kubectl commands (see below).
#
# Usage:
#   1. Generate DKIM keys (see commands below)
#   2. Create Secret using kubectl
#   3. The Secret will be mounted in the KumoMTA pods
#
# See: charts/kumomta/kumo-configs/dkim_data.toml for configuration

###################################
# Step 1: Generate DKIM Keys
###################################
# 
# Generate a 2048-bit RSA key pair for DKIM signing:
#
#   # Generate private key
#   openssl genrsa -out example.com.default.key 2048
#
#   # Generate public key (for DNS record)
#   openssl rsa -in example.com.default.key -pubout -out example.com.default.pub
#
#   # Extract public key in DNS format (remove headers/footers)
#   openssl rsa -in example.com.default.key -pubout -outform DER | \
#     openssl base64 -A
#
# The public key should be added to DNS as a TXT record:
#   default._domainkey.example.com TXT "v=DKIM1; k=rsa; p=<public-key>"
#
# See: https://docs.kumomta.com/userguide/configuration/dkim/

###################################
# Step 2: Create Kubernetes Secret
###################################
# 
# Create the Secret using kubectl:
#
#   kubectl create secret generic dkim-keys \
#     --from-file=example.com.default.key=/path/to/example.com.default.key \
#     --namespace=kumomta
#
# Or using a YAML file (base64-encoded):
#
#   kubectl create secret generic dkim-keys \
#     --from-literal=example.com.default.key="$(cat example.com.default.key)" \
#     --namespace=kumomta
#
# Verify the Secret:
#   kubectl get secret dkim-keys -n kumomta -o yaml

###################################
# Step 3: Secret YAML Format (for reference)
###################################
# 
# The Secret should look like this (DO NOT use this directly,
# generate keys first):
#
apiVersion: v1
kind: Secret
metadata:
  name: dkim-keys
  namespace: kumomta
type: Opaque
data:
  # Base64-encoded private key
  # To encode: cat example.com.default.key | base64
  example.com.default.key: |
    LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVB...
    # ... (actual base64-encoded key content)
    ...LS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K

###################################
# Step 4: Verify DNS Configuration
###################################
# 
# After creating the Secret, verify your DNS configuration:
#
#   dig TXT default._domainkey.example.com
#
# The DNS record should contain:
#   v=DKIM1; k=rsa; p=<public-key>
#
# Test DKIM signing:
#   Use a tool like https://www.appmaildev.com/en/dkim to verify
#   that your emails are properly signed.

###################################
# Security Best Practices
###################################
# 
# 1. Store DKIM keys in a secure location (not in git)
# 2. Use Kubernetes Secrets (encrypted at rest if enabled)
# 3. Rotate keys periodically
# 4. Use different keys for different environments
# 5. Monitor for key compromise
# 6. Consider using Hashicorp Vault for key management
#    (see dkim_data.toml for Vault configuration)
